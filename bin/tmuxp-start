#!/bin/sh

if [ -n "$1" ]; then
    selected="$1"
else
    selected=$(find $PERSONAL_PROJECTS $WORK_PROJECTS -mindepth 1 -maxdepth 1 -type d | fzf)
fi
if [ -z "$selected" ]; then
    exit 1
fi

selected_name=$(basename "$selected")

if [ -f "$selected/$TMUX_TEMPLATE" ]; then
    if [ "$selected_name" = anonymous ]; then
        PROJECT_NAME="$(uuid)"
        WORKSPACE="$(pwd)"
    else
        PROJECT_NAME="$selected_name"
        WORKSPACE="$selected"
    fi
    PROJECT_NAME="$PROJECT_NAME" \
    WORKSPACE="$WORKSPACE" \
    tmuxp load \
        --yes \
        -f "$TMUX_CONFIG" \
        "$selected/$TMUX_TEMPLATE"
else
    echo "tmuxp session not found"
    exit 1
fi
